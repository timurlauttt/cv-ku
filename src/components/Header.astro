---
const currentPath = Astro.url.pathname;
---

<header class="container mx-auto">
  <div class="flex items-center justify-between py-6 lg:py-10">
    <a href="/" class="flex items-center">
      <p class="hidden font-body text-2xl font-bold text-primary lg:block">
        Urip
      </p>
    </a>
    
    <nav class="hidden lg:block">
      <ul class="flex items-center">
        <li class="group relative mr-6 mb-1">
          <div class="absolute left-0 bottom-0 z-20 h-0 w-full opacity-75 transition-all group-hover:h-2 group-hover:bg-yellow"></div>
          <a href="/" class="relative z-30 block px-2 font-body text-lg font-medium text-primary transition-colors group-hover:text-green">
            Intro
          </a>
        </li>
        <li class="group relative mr-6 mb-1">
          <div class="absolute left-0 bottom-0 z-20 h-0 w-full opacity-75 transition-all group-hover:h-2 group-hover:bg-yellow"></div>
          <a href="/blog" class="relative z-30 block px-2 font-body text-lg font-medium text-primary transition-colors group-hover:text-green">
            Blog
          </a>
        </li>
        <li class="group relative mr-6 mb-1">
          <div class="absolute left-0 bottom-0 z-20 h-0 w-full opacity-75 transition-all group-hover:h-2 group-hover:bg-yellow"></div>
          <a href="/uses" class="relative z-30 block px-2 font-body text-lg font-medium text-primary transition-colors group-hover:text-green">
            Uses
          </a>
        </li>
        <li class="group relative mr-6 mb-1">
          <div class="absolute left-0 bottom-0 z-20 h-0 w-full opacity-75 transition-all group-hover:h-2 group-hover:bg-yellow"></div>
          <a href="/contact" class="relative z-30 block px-2 font-body text-lg font-medium text-primary transition-colors group-hover:text-green">
            Contact
          </a>
        </li>
      </ul>
    </nav>
    
    <div class="flex items-center lg:hidden">
      <button id="mobile-menu-toggle" class="text-primary">
        <svg width="24" height="15" xmlns="http://www.w3.org/2000/svg" class="fill-current">
          <g fill-rule="evenodd">
            <rect width="24" height="3" rx="1.5" />
            <rect x="8" y="6" width="16" height="3" rx="1.5" />
            <rect x="4" y="12" width="20" height="3" rx="1.5" />
          </g>
        </svg>
      </button>
    </div>
  </div>
</header>

<!-- Mobile Menu -->
<div id="mobile-menu" class="pointer-events-none fixed inset-0 z-50 flex bg-black bg-opacity-80 opacity-0 transition-opacity lg:hidden">
  <div class="ml-auto w-2/3 bg-green p-4 md:w-1/3">
    <button id="mobile-menu-close" class="absolute top-0 right-0 mt-4 mr-4 text-4xl text-white">
      <i class="bx bx-x"></i>
    </button>
    <ul class="mt-8 flex flex-col">
      <li>
        <a href="/" class="mb-3 block px-2 font-body text-lg font-medium text-white">
          Intro
        </a>
      </li>
      <li>
        <a href="/blog" class="mb-3 block px-2 font-body text-lg font-medium text-white">
          Blog
        </a>
      </li>
      <li>
        <a href="/uses" class="mb-3 block px-2 font-body text-lg font-medium text-white">
          Uses
        </a>
      </li>
      <li>
        <a href="/contact" class="mb-3 block px-2 font-body text-lg font-medium text-white">
          Contact
        </a>
      </li>
    </ul>
  </div>
</div>

<script>
  // Flag to prevent multiple initializations
  let isInitialized = false;
  
  function setupMobileMenu() {
    const menuToggle = document.getElementById('mobile-menu-toggle');
    const menuClose = document.getElementById('mobile-menu-close');
    const mobileMenu = document.getElementById('mobile-menu');
    
    if (menuToggle && !menuToggle.dataset.menuListenerAttached) {
      menuToggle.dataset.menuListenerAttached = 'true';
      menuToggle.addEventListener('click', () => {
        mobileMenu?.classList.remove('opacity-0', 'pointer-events-none');
        mobileMenu?.classList.add('opacity-100', 'pointer-events-auto');
        document.body.classList.add('overflow-hidden');
      });
    }
    
    if (menuClose && !menuClose.dataset.closeListenerAttached) {
      menuClose.dataset.closeListenerAttached = 'true';
      menuClose.addEventListener('click', () => {
        mobileMenu?.classList.add('opacity-0', 'pointer-events-none');
        mobileMenu?.classList.remove('opacity-100', 'pointer-events-auto');
        document.body.classList.remove('overflow-hidden');
      });
    }
    
    // Close menu when clicking on a link
    const menuLinks = mobileMenu?.querySelectorAll('a');
    menuLinks?.forEach(link => {
      if (!link.dataset.closeOnClickAttached) {
        link.dataset.closeOnClickAttached = 'true';
        link.addEventListener('click', () => {
          mobileMenu?.classList.add('opacity-0', 'pointer-events-none');
          mobileMenu?.classList.remove('opacity-100', 'pointer-events-auto');
          document.body.classList.remove('overflow-hidden');
        });
      }
    });
  }
  
  function init() {
    if (!isInitialized) {
      isInitialized = true;
      setupMobileMenu();
    }
  }
  
  // Initialize on load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
  
  // Re-initialize on Astro page transitions
  document.addEventListener('astro:after-swap', () => {
    isInitialized = false;
    init();
  });
</script>
